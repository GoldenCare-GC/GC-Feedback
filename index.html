<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Care Feedback</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* --- General Body & Root Styles --- */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden; /* Hide scrollbars */
            font-family: Arial, sans-serif;
            color: #4a5568; /* Default text color (grey) */
            background-color: #f0f2f5; /* Light grey background for the page */
        }

        /* --- Text Logo Styling --- */
        .app-title {
            font-size: 3em; /* Adjust size as needed */
            font-weight: bold;
            margin-bottom: 10px; /* Space below title */
            display: flex;
            justify-content: center;
            align-items: baseline; /* Align text baselines */
            text-align: center;
        }
        .golden-text {
            color: #e67e22; /* Golden Care Orange */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1); 
        }
        .care-text {
            color: #4a5568; /* Grey */
            margin-left: 5px; /* Space between Golden and Care */
        }

        /* Styles for the feedback form container */
        .feedback-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.5) 0%, rgba(240,240,240,0.5) 100%);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 600px;
            width: 100%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            max-height: 90vh;
            overflow-y: auto;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            position: relative;
        }

        /* Headings Styles */
        .feedback-container h2 {
            color: #555;
            text-align: center;
            margin-top: 0; 
            margin-bottom: 10px; /* Reduced margin to bring disclaimer closer */
            font-size: 22px; 
        }

        /* Paragraph Text Styles */
        .feedback-container p {
            font-size: 16px;
            line-height: 1.6; 
            margin-bottom: 10px;
            color: #4a5568; 
        }

        /* Question Text Styles */
        .feedback-container .question {
            font-weight: bold;
            margin-bottom: 15px; 
            text-align: left;
            padding-left: 10px;
            font-size: 17px; 
            color: #333; 
        }

        /* Rating Section Styles */
        .feedback-container .rating {
            display: flex;
            justify-content: space-between;
            margin: 15px 0 25px 0; 
            flex-wrap: wrap; 
            gap: 8px; 
        }
        .feedback-container .rating input {
            display: none; 
        }
        .feedback-container .rating.emoji-rating label {
            font-size: 36px; 
            cursor: pointer;
            padding: 5px; 
            transition: all 0.2s ease-in-out; 
        }
        .feedback-container .rating.emoji-rating label:hover {
            transform: scale(1.1); 
        }

        /* Style for selected emoji labels */
        .feedback-container .rating.emoji-rating input:checked + label {
            border: 2px solid #e67e22; 
            border-radius: 5px;
            background-color: #fffaf0;
        }

        /* Number Box Styles */
        .feedback-container .number-box {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px; 
            height: 45px;
            border-radius: 5px; 
            margin: 2px; 
        }
        .feedback-container .number-box label {
            font-size: 18px; 
            line-height: 1; 
            color: #555; 
            padding: 0; 
            display: flex; 
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            cursor: pointer; 
            border-radius: 5px; 
            border: 1px solid #ccc;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1);
            box-sizing: border-box; 
            transition: all 0.2s ease-in-out; 
        }
        .feedback-container .number-box label:hover {
            border-color: #e67e22; 
            box-shadow: 0 0 8px rgba(230, 126, 34, 0.4);
        }
        .feedback-container .number-box input:checked + label {
            background-color: white; 
            color: #e67e22; 
            border: 2px solid #e67e22; 
            border-radius: 5px;
            box-shadow: 0 0 12px rgba(230, 126, 34, 0.7); 
        }

        /* Submit Button Styles */
        .feedback-container .button {
            background-color: #e67e22; 
            color: white;
            padding: 15px 30px; 
            border: none;
            border-radius: 25px; 
            text-decoration: none;
            font-size: 17px; 
            font-weight: 600; 
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease; 
            display: block;
            margin: 30px auto 10px auto; 
            max-width: 200px; 
        }
        .feedback-container .button:hover {
            background-color: #d35400; 
            transform: translateY(-2px); 
        }
        .feedback-container .button:active {
            transform: translateY(0); 
        }
        .feedback-container .button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Comment & Contact Info Section Styles */
        #commentAndContactSection {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: left;
        }
        #commentAndContactSection label {
            font-weight: 600;
            margin-bottom: 5px;
            display: block; 
            color: #333;
            margin-top: 15px;
        }
        #commentAndContactSection textarea,
        #commentAndContactSection input[type="text"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 15px;
            box-sizing: border-box; 
        }
        #commentAndContactSection textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        #contactInfo {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        #contactInfo.hidden {
            display: none;
        }

        /* Disclaimer Text Style */
        .disclaimer-text {
            font-size: 13px; /* Slightly larger for readability */
            color: #777;
            margin-bottom: 25px; /* Space between disclaimer and first question */
            text-align: center;
            font-style: italic;
        }

        /* Full-page Image Background Styles */
        #background-image-container { 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background-image: url('https://i.imgur.com/Jnnnetb.png'); 
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat; 
        }

        /* Responsive Adjustments */
        @media (max-width: 480px) {
            .feedback-container {
                padding: 20px;
                margin: 10px; 
                width: calc(100% - 20px); 
            }
            .app-title { font-size: 2.2em; }
            .feedback-container h2 { font-size: 20px; }
            .feedback-container .question { font-size: 16px; }
            .feedback-container .rating { justify-content: center; }
            .feedback-container .rating.emoji-rating label { font-size: 30px; }
            .feedback-container .number-box { width: 40px; height: 40px; }
            .feedback-container .number-box label { font-size: 16px; }
            .feedback-container .button { padding: 12px 20px; font-size: 15px; }
            #commentAndContactSection textarea,
            #commentAndContactSection input[type="text"] {
                width: calc(100% - 10px); 
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div id="background-image-container"></div>

    <div class="feedback-container">
        <div class="app-title">
            <span class="golden-text">Golden</span><span class="care-text">Care</span>
        </div>
        
        <h2>Feedback Form</h2>
        <!-- MOVED: Disclaimer is now here -->
        <p class="disclaimer-text">
            This is an autonomous feedback form. Your submission is anonymous unless you voluntarily provide your contact information.
        </p>

        <form id="feedbackForm">
            <p class="question">1. On a scale of 1-10, how likely are you to recommend Golden Care to a friend or family member?</p>
            <div class="rating">
                <div class="number-box"><input type="radio" id="rating1" name="recommendation" value="1" required><label for="rating1">1</label></div>
                <div class="number-box"><input type="radio" id="rating2" name="recommendation" value="2" required><label for="rating2">2</label></div>
                <div class="number-box"><input type="radio" id="rating3" name="recommendation" value="3" required><label for="rating3">3</label></div>
                <div class="number-box"><input type="radio" id="rating4" name="recommendation" value="4" required><label for="rating4">4</label></div>
                <div class="number-box"><input type="radio" id="rating5" name="recommendation" value="5" required><label for="rating5">5</label></div>
                <div class="number-box"><input type="radio" id="rating6" name="recommendation" value="6" required><label for="rating6">6</label></div>
                <div class="number-box"><input type="radio" id="rating7" name="recommendation" value="7" required><label for="rating7">7</label></div>
                <div class="number-box"><input type="radio" id="rating8" name="recommendation" value="8" required><label for="rating8">8</label></div>
                <div class="number-box"><input type="radio" id="rating9" name="recommendation" value="9" required><label for="rating9">9</label></div>
                <div class="number-box"><input type="radio" id="rating10" name="recommendation" value="10" required><label for="rating10">10</label></div>
            </div>

            <p class="question">2. How would you rate the care and compassion you or your loved one received during the visit?</p>
            <div class="rating emoji-rating">
                <input type="radio" id="care1" name="care" value="Very Dissatisfied" required><label for="care1">üò°</label>
                <input type="radio" id="care2" name="care" value="Dissatisfied" required><label for="care2">üòü</label>
                <input type="radio" id="care3" name="care" value="Neutral" required><label for="care3">üòê</label>
                <input type="radio" id="care4" name="care" value="Satisfied" required><label for="care4">üôÇ</label>
                <input type="radio" id="care5" name="care" value="Very Satisfied" required><label for="care5">üòÉ</label>
            </div>

            <p class="question">3. How would you rate your overall satisfaction with the services provided?</p>
            <div class="rating emoji-rating">
                <input type="radio" id="satisfaction1" name="satisfaction" value="Very Dissatisfied" required><label for="satisfaction1">üò°</label>
                <input type="radio" id="satisfaction2" name="satisfaction" value="Dissatisfied" required><label for="satisfaction2">üòü</label>
                <input type="radio" id="satisfaction3" name="satisfaction" value="Neutral" required><label for="satisfaction3">üòê</label>
                <input type="radio" id="satisfaction4" name="satisfaction" value="Satisfied" required><label for="satisfaction4">üôÇ</label>
                <input type="radio" id="satisfaction5" name="satisfaction" value="Very Satisfied" required><label for="satisfaction5">üòÉ</label>
            </div>

            <div id="commentAndContactSection">
                <p id="commentMessage" class="question">What's the primary reason for your score?</p> 
                <label for="commentsTextarea"></label>
                <textarea id="commentsTextarea" rows="4" required></textarea>

                <div id="contactInfo" class="hidden">
                    <p>We are sorry to hear that our service hasn't met your expectations. We would love the opportunity to learn more from this situation to help us do better next time. If you're open to a discussion, please share your details below.</p>
                    
                    <label for="phoneNumber">Phone Number:</label>
                    <input type="text" id="phoneNumber" name="phoneNumber" placeholder="Enter your phone number">
                    
                    <label id="nameLabel" for="nameInput">Your Name:</label>
                    <input type="text" id="nameInput" name="nameInput" placeholder="Enter your name (optional)">
                </div>
                
                <button type="submit" id="finalSubmitButton" class="button">Submit Feedback</button>
            </div>
        </form>
    </div>

    <script type="module"> 
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyA9Xny9hPIxbA-ZlMtFIufwa6KEduEDVXU",
          authDomain: "feedback-gc2025.firebaseapp.com",
          projectId: "feedback-gc2025",
          storageBucket: "feedback-gc2025.firebasestorage.app",
          messagingSenderId: "121481265924",
          appId: "1:121481265924:web:730fa79ca0f09d376e4651",
          measurementId: "G-7CZ56QYR8X"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        document.addEventListener('DOMContentLoaded', () => {
            const feedbackForm = document.getElementById('feedbackForm');
            const commentsTextarea = document.getElementById('commentsTextarea');
            const contactInfoDiv = document.getElementById('contactInfo');
            const phoneNumberInput = document.getElementById('phoneNumber');
            const nameInput = document.getElementById('nameInput');
            const nameLabel = document.getElementById('nameLabel');
            const finalSubmitButton = document.getElementById('finalSubmitButton');
            const commentMessage = document.getElementById('commentMessage'); 

            const allRadios = document.querySelectorAll('input[type="radio"]');

            function updateDynamicSections() {
                const recommendationValue = document.querySelector('input[name="recommendation"]:checked')?.value;

                let baseQuestion = "What's the primary reason for your score?";
                let specificQuestionPart = "";
                let placeholderSpecific = "Please tell us more..."; 

                if (recommendationValue) {
                    const recNum = parseInt(recommendationValue);

                    if (recNum >= 9) {
                        specificQuestionPart = " What do you love most about us?";
                        placeholderSpecific = "E.g., What did you like about our service, staff, or experience?";
                    } else if (recNum === 8 || recNum === 7) { // Changed to include 7 here
                        specificQuestionPart = " What could we do better?";
                        placeholderSpecific = "E.g., How can we improve our service or your experience?";
                    } else { // Detractors (1-6)
                        specificQuestionPart = " What caused you to give that score?";
                        placeholderSpecific = "E.g., What went wrong, or what were your concerns?";
                    }
                }
                commentMessage.textContent = baseQuestion + specificQuestionPart;
                commentsTextarea.placeholder = placeholderSpecific;

                // --- UPDATED LOGIC for Contact Info: Show if score is 7 or less ---
                let isLowScore = false;
                if (recommendationValue) {
                    const recNum = parseInt(recommendationValue);
                    isLowScore = recNum <= 7; // Condition is now score 7 or less
                }

                if (isLowScore) {
                    contactInfoDiv.classList.remove('hidden');
                    phoneNumberInput.setAttribute('required', 'required');
                    nameLabel.textContent = "Your Name (Optional, but having it helps us understand your feedback better and improve our service):";
                } else {
                    contactInfoDiv.classList.add('hidden');
                    phoneNumberInput.removeAttribute('required');
                    nameLabel.textContent = "Your Name:"; 
                }
            }

            allRadios.forEach(radio => {
                radio.addEventListener('change', updateDynamicSections);
            });

            updateDynamicSections();

            function resetFeedbackProcess() {
                feedbackForm.reset(); 
                updateDynamicSections(); 
                finalSubmitButton.disabled = false;
                finalSubmitButton.textContent = 'Submit Feedback';
            }

            feedbackForm.addEventListener('submit', async function(event) { 
                event.preventDefault(); 
                
                const recommendation = document.querySelector('input[name="recommendation"]:checked');
                const care = document.querySelector('input[name="care"]:checked');
                const satisfaction = document.querySelector('input[name="satisfaction"]:checked');
                
                if (!recommendation || !care || !satisfaction) {
                    alert('Please answer all rating questions before submitting.');
                    return;
                }

                if (commentsTextarea.value.trim() === '') {
                    alert('Please provide your comments for the recommendation score.');
                    commentsTextarea.focus();
                    return;
                }

                const recommendationValue = parseInt(recommendation.value);

                const feedbackData = {
                    recommendation: recommendationValue,
                    care: care.value,
                    satisfaction: satisfaction.value,
                    comments: commentsTextarea.value.trim(),
                    timestamp: new Date().toISOString()
                };

                // --- UPDATED LOGIC for Data Collection: Collect if score is 7 or less ---
                if (recommendationValue <= 7) {
                    const phoneNumber = phoneNumberInput.value.trim();
                    const name = nameInput.value.trim();

                    if (!phoneNumber) {
                        alert("Please provide a phone number so we can follow up on your feedback.");
                        phoneNumberInput.focus();
                        return;
                    }
                    
                    feedbackData.phoneNumber = phoneNumber;
                    if (name) {
                        feedbackData.name = name;
                    }
                }

                const originalBtnText = finalSubmitButton.textContent;
                finalSubmitButton.disabled = true;
                finalSubmitButton.textContent = 'Submitting...';

                try {
                    await addDoc(collection(db, 'feedback'), feedbackData);

                    const isPositiveFeedback = (recommendationValue >= 9);

                    if (isPositiveFeedback) {
                        window.open('https://www.google.com/maps/place//data!4m3!3m2!1s0x882b328b0bfefb7f:0xd08043c55ff9005e!12e1?source=g.page.m.nr._&laa=nmx-review-solicitation-recommendation-card', '_blank');
                        alert('Thank you for your positive feedback! We would love for you to share your experience on Google. Please consider posting a review.');
                    } else {
                        alert('Thank you for your valuable feedback!');
                    }
                    
                    resetFeedbackProcess();

                } catch (error) {
                    console.error('Error sending feedback data to Firestore:', error);
                    alert('There was an error submitting your feedback. Please try again.');
                } finally {
                    finalSubmitButton.disabled = false; 
                    finalSubmitButton.textContent = originalBtnText;
                }
            });
        });
    </script>
</body>
</html>
