
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Care Feedback</title>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- 
        Firebase SDKs - v9 Modular syntax via CDN
        IMPORTANT: When using <script type="module"> and 'import' statements,
        DO NOT include separate <script src="..."> tags for firebase-app.js, firebase-firestore.js, etc.
        The 'import' statements inside the module script handle loading these.
        Removing the redundant direct script tags to prevent module conflicts.
    -->
    
    <style>
        /* --- General Body & Root Styles --- */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden; /* Hide scrollbars */
            font-family: Arial, sans-serif;
            color: #4a5568; /* Default text color (grey) */
            background-color: #f0f2f5; /* Light grey background for the page */
        }

        /* --- Text Logo Styling --- */
        .app-title {
            font-size: 3em; /* Adjust size as needed */
            font-weight: bold;
            margin-bottom: 10px; /* Space below title */
            display: flex;
            justify-content: center;
            align-items: baseline; /* Align text baselines */
            text-align: center;
        }
        .golden-text {
            color: #e67e22; /* Golden Care Orange */
            /* Add some shadow for depth if desired */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1); 
        }
        .care-text {
            color: #4a5568; /* Grey */
            margin-left: 5px; /* Space between Golden and Care */
        }

        /* Styles for the feedback form container */
        .feedback-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.5) 0%, rgba(240,240,240,0.5) 100%);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); /* Stronger shadow for pop-out effect */
            text-align: center;
            max-width: 600px;
            width: 100%;
            position: absolute; /* Positioned absolutely over the image background */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10; /* Ensure form is above the image background */
            max-height: 90vh; /* Prevent container from being too tall on small screens */
            overflow-y: auto; /* Enable scrolling for the form if it exceeds height */
            backdrop-filter: blur(8px); /* Add a more noticeable blur behind the form for better readability */
            -webkit-backdrop-filter: blur(8px); /* Safari support */
            position: relative; /* Needed for positioning the viewer-link inside */
        }

        /* Headings Styles */
        .feedback-container h2 {
            color: #555; /* Muted grey for a sub-heading */
            text-align: center;
            margin-top: 0; 
            margin-bottom: 25px; 
            font-size: 22px; 
        }

        /* Paragraph Text Styles */
        .feedback-container p {
            font-size: 16px;
            line-height: 1.6; 
            margin-bottom: 10px;
            color: #4a5568; 
        }

        /* Question Text Styles */
        .feedback-container .question {
            font-weight: bold;
            margin-bottom: 15px; 
            text-align: left;
            padding-left: 10px;
            font-size: 17px; 
            color: #333; 
        }

        /* Rating Section Styles (for both number and emoji ratings) */
        .feedback-container .rating {
            display: flex;
            justify-content: space-between;
            margin: 15px 0 25px 0; 
            flex-wrap: wrap; 
            gap: 8px; 
        }
        .feedback-container .rating input {
            display: none; 
        }
        /* Specific label styles for emoji ratings */
        .feedback-container .rating.emoji-rating label { /* Added a class for distinction */
            font-size: 36px; 
            cursor: pointer;
            padding: 5px; 
            transition: all 0.2s ease-in-out; 
        }
        .feedback-container .rating.emoji-rating label:hover {
            transform: scale(1.1); 
        }

        /* Style for selected emoji labels */
        .feedback-container .rating.emoji-rating input:checked + label {
            border: 2px solid #e67e22; 
            border-radius: 5px;
            background-color: #fffaf0; /* Keep this for emoji, which is a light cream */
        }

        /* Number Box Styles (for 1-10 rating scale) */
        .feedback-container .number-box {
            display: inline-flex; /* Use inline-flex for proper sizing in a flex container */
            align-items: center;
            justify-content: center;
            width: 45px; 
            height: 45px;
            border-radius: 5px; 
            margin: 2px; 
            /* Removed default border/shadow/transition from .number-box itself */
        }
        .feedback-container .number-box label {
            font-size: 18px; 
            line-height: 1; 
            color: #555; 
            padding: 0; 
            display: flex; 
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            cursor: pointer; 
            border-radius: 5px; 
            border: 1px solid #ccc; /* Default border for the label */
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1); /* Subtle default shadow */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            transition: all 0.2s ease-in-out; /* Smooth transitions for hover/checked states */
        }
        /* Hover style for the label */
        .feedback-container .number-box label:hover {
            border-color: #e67e22; 
            box-shadow: 0 0 8px rgba(230, 126, 34, 0.4); /* Stronger shadow on hover */
        }

        /* Style for selected number boxes - apply to the label itself */
        .feedback-container .number-box input:checked + label {
            background-color: white; /* Changed to white background */
            color: #e67e22; /* Changed text color to golden orange */
            border: 2px solid #e67e22; /* Changed border color to golden orange */
            border-radius: 5px;
            box-shadow: 0 0 12px rgba(230, 126, 34, 0.7); /* Even stronger shadow for checked state */
        }

        /* Submit Button Styles (now for the final form submission) */
        .feedback-container .button {
            background-color: #e67e22; 
            color: white;
            padding: 15px 30px; 
            border: none;
            border-radius: 25px; 
            text-decoration: none;
            font-size: 17px; 
            font-weight: 600; 
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease; 
            display: block;
            margin: 30px auto 10px auto; 
            max-width: 200px; 
        }
        .feedback-container .button:hover {
            background-color: #d35400; 
            transform: translateY(-2px); 
        }
        .feedback-container .button:active {
            transform: translateY(0); 
        }
        .feedback-container .button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* --- New Comment & Contact Info Section Styles --- */
        #commentAndContactSection {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee; /* Separator line */
            text-align: left;
            /* Removed display: none; - this section is always visible now */
        }
        /* No specific #commentAndContactSection #commentMessage rule here,
           relying on .question class for styling. */
        #commentAndContactSection label {
            font-weight: 600;
            margin-bottom: 5px;
            display: block; 
            color: #333;
            margin-top: 15px; /* Spacing for labels */
        }
        #commentAndContactSection textarea,
        #commentAndContactSection input[type="text"] {
            width: calc(100% - 20px); /* Account for padding */
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 15px;
            box-sizing: border-box; 
        }
        #commentAndContactSection textarea {
            min-height: 80px; /* Minimum height for textarea */
            resize: vertical; /* Allow vertical resizing */
        }
        
        /* Style for the nested contactInfo div */
        #contactInfo {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        #contactInfo.hidden {
            display: none;
        }


        /* --- Viewer Link Styles (Icon) --- */
        .viewer-link {
            position: absolute;
            top: 15px; /* Adjust as needed */
            right: 15px; /* Adjust as needed */
            background-color: #e67e22;
            color: white;
            width: 40px; /* Make it a square for the icon */
            height: 40px;
            border-radius: 50%; /* Make it a circle */
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 1.2em; /* Size of the icon */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 11; /* Ensure it's above other content if necessary */
        }
        .viewer-link:hover {
            background-color: #d35400;
            transform: translateY(-2px) scale(1.05);
        }
        .viewer-link:active {
            transform: translateY(0) scale(1);
        }


        /* --- Full-page Image Background Styles --- */
        #background-image-container { 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; /* Behind the feedback form */
            background-image: url('https://i.imgur.com/Jnnnetb.png'); 
            background-size: cover; /* Ensures the image covers the entire container */
            background-position: center; /* Centers the image */
            background-repeat: no-repeat; /* Prevents image repetition */
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 480px) {
            .feedback-container {
                padding: 20px;
                border-radius: 5px;
                margin: 10px; 
                width: calc(100% - 20px); 
                padding-bottom: 20px; 
            }
            .app-title {
                font-size: 2.2em;
            }
            .feedback-container h2 {
                font-size: 20px; 
                margin-bottom: 20px;
            }
            .feedback-container .question {
                font-size: 16px;
                padding-left: 5px;
            }
            .feedback-container .rating {
                justify-content: center; 
            }
            .feedback-container .rating.emoji-rating label {
                font-size: 30px; 
            }
            .feedback-container .number-box {
                width: 40px;
                height: 40px;
            }
            .feedback-container .number-box label {
                font-size: 16px;
            }
            .feedback-container .button {
                padding: 12px 20px;
                font-size: 15px;
            }
            #commentAndContactSection textarea,
            #commentAndContactSection input[type="text"] {
                width: calc(100% - 10px); /* Adjust for smaller padding if needed */
                padding: 8px;
            }
            .viewer-link {
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <!-- Container for the static image background -->
    <div id="background-image-container"></div>

    <!-- Feedback Form -->
    <div class="feedback-container">
        <div class="app-title">
            <span class="golden-text">Golden</span><span class="care-text">Care</span>
        </div>
        <a href="Viewer.html" class="viewer-link" title="View Feedback">
            <i class="fas fa-file-alt"></i> <!-- Font Awesome document icon -->
        </a>
        <h2>Feedback Form</h2>
        <form id="feedbackForm">
            <p class="question">1. On a scale of 1-10, how likely are you to recommend Golden Care to a friend or family member?</p>
            <div class="rating">
                <!-- Corrected HTML structure for number boxes: input as sibling to label -->
                <div class="number-box"><input type="radio" id="rating1" name="recommendation" value="1" required><label for="rating1">1</label></div>
                <div class="number-box"><input type="radio" id="rating2" name="recommendation" value="2" required><label for="rating2">2</label></div>
                <div class="number-box"><input type="radio" id="rating3" name="recommendation" value="3" required><label for="rating3">3</label></div>
                <div class="number-box"><input type="radio" id="rating4" name="recommendation" value="4" required><label for="rating4">4</label></div>
                <div class="number-box"><input type="radio" id="rating5" name="recommendation" value="5" required><label for="rating5">5</label></div>
                <div class="number-box"><input type="radio" id="rating6" name="recommendation" value="6" required><label for="rating6">6</label></div>
                <div class="number-box"><input type="radio" id="rating7" name="recommendation" value="7" required><label for="rating7">7</label></div>
                <div class="number-box"><input type="radio" id="rating8" name="recommendation" value="8" required><label for="rating8">8</label></div>
                <div class="number-box"><input type="radio" id="rating9" name="recommendation" value="9" required><label for="rating9">9</label></div>
                <div class="number-box"><input type="radio" id="rating10" name="recommendation" value="10" required><label for="rating10">10</label></div>
            </div>

            <p class="question">2. How would you rate the care and compassion you or your loved one received during the visit?</p>
            <div class="rating emoji-rating">
                <input type="radio" id="care1" name="care" value="Very Dissatisfied" required><label for="care1">😡</label>
                <input type="radio" id="care2" name="care" value="Dissatisfied" required><label for="care2">😟</label>
                <input type="radio" id="care3" name="care" value="Neutral" required><label for="care3">😐</label>
                <input type="radio" id="care4" name="care" value="Satisfied" required><label for="care4">🙂</label>
                <input type="radio" id="care5" name="care" value="Very Satisfied" required><label for="care5">😃</label>
            </div>

            <p class="question">3. How would you rate your overall satisfaction with the services provided?</p>
            <div class="rating emoji-rating">
                <input type="radio" id="satisfaction1" name="satisfaction" value="Very Dissatisfied" required><label for="satisfaction1">😡</label>
                <input type="radio" id="satisfaction2" name="satisfaction" value="Dissatisfied" required><label for="satisfaction2">😟</label>
                <input type="radio" id="satisfaction3" name="satisfaction" value="Neutral" required><label for="satisfaction3">😐</label>
                <input type="radio" id="satisfaction4" name="satisfaction" value="Satisfied" required><label for="satisfaction4">🙂</label>
                <input type="radio" id="satisfaction5" name="satisfaction" value="Very Satisfied" required><label for="satisfaction5">😃</label>
            </div>

            <!-- New Comment & Optional Contact Info Section -->
            <div id="commentAndContactSection"> <!-- Always visible now -->
                <!-- This p tag will dynamically get the bolded question text from JS -->
                <p id="commentMessage" class="question">What's the primary reason for your score?</p> 
                <label for="commentsTextarea"></label> <!-- Label remains empty, as per previous instruction -->
                <textarea id="commentsTextarea" rows="4" required></textarea> <!-- Always required now -->

                <div id="contactInfo" class="hidden">
                    <p>We are sorry to hear that our service hasn't met your expectations. We would love the opportunity to learn more from this situation to help us do better next time. If you're open to a discussion, please share your phone number and the best time to reach you and our team will contact you to discuss.</p>
                    <label for="phoneNumber">Phone Number:</label>
                    <input type="text" id="phoneNumber" name="phoneNumber" placeholder="Enter your phone number">
                    
                    <label for="bestTime">Best Time to Contact:</label>
                    <input type="text" id="bestTime" name="bestTime" placeholder="Enter the best time to reach you">
                </div>
                
                <!-- This is now the ONE submit button for the entire form -->
                <button type="submit" id="finalSubmitButton" class="button">Submit Feedback</button>
            </div>
        </form>
    </div>

    <script type="module"> 
        // Import Firebase modules for v9 syntax
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyA9Xny9hPIxbA-ZlMtFIufwa6KEduEDVXU",
          authDomain: "feedback-gc2025.firebaseapp.com",
          projectId: "feedback-gc2025",
          storageBucket: "feedback-gc2025.firebasestorage.app",
          messagingSenderId: "121481265924",
          appId: "1:121481265924:web:730fa79ca0f09d376e4651",
          measurementId: "G-7CZ56QYR8X"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app); // Get Firestore instance
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded and parsed');

            const feedbackForm = document.getElementById('feedbackForm');
            const commentsTextarea = document.getElementById('commentsTextarea');
            const contactInfoDiv = document.getElementById('contactInfo');
            const phoneNumberInput = document.getElementById('phoneNumber');
            const bestTimeInput = document.getElementById('bestTime');
            const finalSubmitButton = document.getElementById('finalSubmitButton');
            const commentMessage = document.getElementById('commentMessage'); // This is the <p class="question"> tag
            // const commentAndContactSection = document.getElementById('commentAndContactSection'); // No longer needed for display toggle

            // Select all radio buttons relevant to feedback evaluation
            const recommendationRadios = document.querySelectorAll('input[name="recommendation"]');
            const careRadios = document.querySelectorAll('input[name="care"]');
            const satisfactionRadios = document.querySelectorAll('input[name="satisfaction"]');


            // Function to update the dynamic sections (comment box question/placeholder and contact info visibility)
            function updateDynamicSections() {
                const recommendationValue = document.querySelector('input[name="recommendation"]:checked')?.value;
                const careValue = document.querySelector('input[name="care"]:checked')?.value;
                const satisfactionValue = document.querySelector('input[name="satisfaction"]:checked')?.value;

                // --- Logic for Comment Message and Textarea ---
                let baseQuestion = "What's the primary reason for your score?";
                let specificQuestionPart = "";
                let placeholderSpecific = "Please tell us more..."; // Default placeholder for the textarea

                if (recommendationValue) {
                    const recNum = parseInt(recommendationValue);

                    if (recNum >= 9) { // Promoters
                        specificQuestionPart = " What do you love most about us?";
                        placeholderSpecific = "E.g., What did you like about our service, staff, or experience?";
                    } else if (recNum >= 7 && recNum <= 8) { // Passives
                        specificQuestionPart = " What could we do better?";
                        placeholderSpecific = "E.g., How can we improve our service or your experience?";
                    } else { // Detractors (0-6 scale)
                        specificQuestionPart = " What caused you to give that score?";
                        placeholderSpecific = "E.g., What went wrong, or what were your concerns?";
                    }
                }
                // The comment section is always visible now.
                commentMessage.textContent = baseQuestion + specificQuestionPart; // This will be bold due to .question class
                commentsTextarea.placeholder = placeholderSpecific;
                commentsTextarea.setAttribute('required', 'required'); // Comments textarea is always required


                // --- Logic for Contact Info Visibility ---
                let isNegativeOverallFeedback = false;
                if (recommendationValue && careValue && satisfactionValue) { // Ensure all three are rated
                    const recNum = parseInt(recommendationValue);
                    
                    isNegativeOverallFeedback = (recNum <= 4 && 
                               (careValue === 'Dissatisfied' || careValue === 'Very Dissatisfied') &&
                               (satisfactionValue === 'Dissatisfied' || satisfactionValue === 'Very Dissatisfied'));
                }

                if (isNegativeOverallFeedback) {
                    contactInfoDiv.classList.remove('hidden');
                    phoneNumberInput.setAttribute('required', 'required');
                    bestTimeInput.setAttribute('required', 'required');
                } else {
                    contactInfoDiv.classList.add('hidden');
                    phoneNumberInput.removeAttribute('required');
                    bestTimeInput.removeAttribute('required');
                }
            }

            // Add event listeners to all relevant radio buttons
            [...recommendationRadios, ...careRadios, ...satisfactionRadios].forEach(radio => {
                radio.addEventListener('change', updateDynamicSections);
            });

            // Initial call to set up the form state
            updateDynamicSections();

            // Function to reset the entire feedback process
            function resetFeedbackProcess() {
                feedbackForm.reset(); // Resets all form inputs including radios
                commentsTextarea.value = '';
                phoneNumberInput.value = '';
                bestTimeInput.value = '';
                
                // Comments textarea is always required now
                commentsTextarea.setAttribute('required', 'required'); 
                phoneNumberInput.removeAttribute('required'); // Remove required for contact info on reset
                bestTimeInput.removeAttribute('required');

                // Re-evaluate to hide sections and clear dynamic content
                updateDynamicSections(); 

                finalSubmitButton.disabled = false; // Ensure it's re-enabled
                finalSubmitButton.textContent = 'Submit Feedback'; // Reset text
            }


            feedbackForm.addEventListener('submit', async function(event) { 
                event.preventDefault(); 
                console.log('Form submission triggered');

                const recommendation = document.querySelector('input[name="recommendation"]:checked');
                const care = document.querySelector('input[name="care"]:checked');
                const satisfaction = document.querySelector('input[name="satisfaction"]:checked');
                
                // Basic validation for required rating fields
                if (!recommendation || !care || !satisfaction) {
                    alert('Please answer all questions before submitting.');
                    return;
                }

                const recommendationValue = parseInt(recommendation.value);
                const careValue = care.value;
                const satisfactionValue = satisfaction.value;
                const comments = commentsTextarea.value.trim(); // Get comments

                // Validate comments since it's always required
                if (commentsTextarea.value.trim() === '') {
                    alert('Please provide your comments for the recommendation score.');
                    commentsTextarea.focus();
                    return;
                }

                const submissionDate = new Date().toISOString(); 

                const feedbackData = {
                    recommendation: recommendationValue,
                    care: careValue,
                    satisfaction: satisfactionValue,
                    comments: comments, // Comments are always included if provided
                    timestamp: submissionDate
                };

                // Check if contact info should be collected (if section is visible due to negative feedback)
                const isNegativeOverallFeedback = (recommendationValue <= 4 && 
                               (careValue === 'Dissatisfied' || careValue === 'Very Dissatisfied') &&
                               (satisfactionValue === 'Dissatisfied' || satisfactionValue === 'Very Dissatisfied'));

                if (isNegativeOverallFeedback && !contactInfoDiv.classList.contains('hidden')) {
                    const phoneNumber = phoneNumberInput.value.trim();
                    const bestTime = bestTimeInput.value.trim();

                    // If contact info section is visible, and inputs are required, validate them
                    if (phoneNumberInput.hasAttribute('required') && bestTimeInput.hasAttribute('required')) {
                         if (!phoneNumber || !bestTime) {
                            alert("Please fill out both phone number and best time fields if you wish to be contacted.");
                            return;
                        }
                    }
                    
                    // Only add to feedbackData if actually provided
                    if (phoneNumber) feedbackData.phoneNumber = phoneNumber;
                    if (bestTime) feedbackData.bestTime = bestTime;
                    if (phoneNumber || bestTime) feedbackData.contactInfoProvided = true;

                }

                const originalBtnText = finalSubmitButton.textContent;
                finalSubmitButton.disabled = true;
                finalSubmitButton.textContent = 'Submitting...';

                try {
                    await addDoc(collection(db, 'feedback'), feedbackData);
                    console.log('Feedback data sent to Firestore successfully.');

                    const isPositiveFeedback = (recommendationValue >= 7 && 
                               (careValue === 'Satisfied' || careValue === 'Very Satisfied') &&
                               (satisfactionValue === 'Satisfied' || satisfactionValue === 'Very Satisfied'));

                    if (isPositiveFeedback) {
                        console.log('Positive feedback detected.');
                        window.open('https://www.google.com/maps/place//data=!4m3!3m2!1s0x882b328b0bfefb7f:0xd08043c55ff9005e!12e1?source=g.page.m.nr._&laa=nmx-review-solicitation-recommendation-card', '_blank');
                        alert('Thank you for your positive feedback! Golden Care Dental Services would love your feedback on Google. Please consider posting a review.');
                    } else {
                        // For neutral/negative, show general thank you, contact info handled by form itself
                        alert('Thank you for your valuable feedback!');
                    }
                    
                    resetFeedbackProcess();

                } catch (error) {
                    console.error('Error sending feedback data to Firestore:', error);
                    alert('There was an error submitting your feedback. Please try again.');
                } finally {
                    finalSubmitButton.disabled = false; 
                    finalSubmitButton.textContent = originalBtnText;
                }
            });
        });
    </script>
</body>
</html>
